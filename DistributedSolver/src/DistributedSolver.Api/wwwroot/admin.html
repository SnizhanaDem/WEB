<!doctype html>
<html lang="uk">
  <head>
    <meta charset="utf-8" />
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container py-4">
      <h1>Admin Dashboard</h1>
      <button id="btn-load" class="btn btn-primary mb-3">Оновити статистику</button>
      <div id="stats" class="mb-3"></div>
      <div id="server-load" class="mb-3"></div>
    </div>
    <script>
      document.getElementById('btn-load').onclick = async function() {
        const token = localStorage.getItem('ds_token');
        const res = await fetch('/api/admin/stats', { headers: { 'Authorization': 'Bearer ' + token } });
        const data = await res.json();
        document.getElementById('stats').innerHTML = `
          <h3>Статистика задач</h3>
          <ul class="list-group">
            <li class="list-group-item">Pending (у черзі): <b>${data.pending || 0}</b></li>
            <li class="list-group-item">Processing (обробляється): <b>${data.processing || 0}</b></li>
            <li class="list-group-item">Done (завершено): <b>${data.done || 0}</b></li>
            <li class="list-group-item">Cancelled (скасовано): <b>${data.cancelled || 0}</b></li>
            <li class="list-group-item">Error (помилки): <b>${data.error || 0}</b></li>
            <li class="list-group-item">Total (всього): <b>${data.total || 0}</b></li>
          </ul>
        `;
        
        // Отримати додаткову інформацію про навантаження
        const resLoad = await fetch('/api/admin/serverload', { headers: { 'Authorization': 'Bearer ' + token } });
        if (resLoad.ok) {
          const load = await resLoad.json();
          document.getElementById('server-load').innerHTML = `
            <h3>Навантаження на систему</h3>
            <ul class="list-group">
              <li class="list-group-item">Активних серверів: <b>${load.activeServers || 'N/A'}</b></li>
              <li class="list-group-item">Середній час виконання: <b>${load.averageExecutionTime || 'N/A'} сек</b></li>
              <li class="list-group-item">Приблизна черга: <b>${load.estimatedQueueWait || 'N/A'} сек</b></li>
            </ul>
          `;
        }
      };
    </script>
  </body>
</html>
